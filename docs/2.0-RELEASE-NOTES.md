# Aetheris 2.0 Release Notes

## 🎉 重大发布：生产级可审计 Agent Runtime

Aetheris 2.0 带来**审计合规 / 取证（Forensics）**的完整能力，通过 3 个里程碑（M1、M2、M3）实现从"可证明"到"可合规"再到"可查询"的完整闭环。

---

## 🚀 新特性

### M1: 可验证证明链

✅ **事件链哈希**: 每个事件包含 SHA256 哈希链，篡改可检测  
✅ **证据包导出**: ZIP 格式，包含完整证据（events + ledger + proof）  
✅ **离线验证**: 无需数据库，任何人可独立验证  
✅ **CLI 工具**: `aetheris export` / `aetheris verify`  

### M2: RBAC + 脱敏 + 留存

✅ **多租户隔离**: Tenant 数据完全隔离，支持 SaaS 部署  
✅ **RBAC**: 4 种角色（Admin/Operator/Auditor/User）+ 8 种权限  
✅ **敏感信息脱敏**: 4 种模式（Redact/Hash/Encrypt/Remove）  
✅ **留存策略**: 按 job 类型配置不同留存期  
✅ **Tombstone 审计**: 删除可追溯，不会"假装没发生过"  
✅ **访问审计**: 所有 API 访问记录到 audit log  

### M3: Evidence Graph + Forensics API

✅ **Evidence Graph**: 决策依据可视化，回答"为什么这么做"  
✅ **Forensics Query**: 支持复杂查询（时间/tool/event 多维度）  
✅ **批量导出**: 异步处理大量 jobs 导出  
✅ **一致性检查**: 验证 hash chain + ledger + evidence 完整性  
✅ **UI 取证视图**: Evidence Graph + Audit Log + Decision Timeline  

---

## 📊 总体统计

### 代码

- **新增文件**: 40 个
- **代码行数**: ~4700 行
- **测试用例**: 27 个（100% 通过）
- **文档**: 13 篇

### 基础设施

- **数据库表**: 7 个新表
- **API Endpoints**: 12 个新端点
- **CLI 命令**: 6 个新命令
- **事件类型**: 11 个新事件

---

## 🔒 安全与合规

### 符合的合规标准

- **GDPR**: 多租户、脱敏、留存策略、可证明删除
- **SOX**: 7 年留存、审计日志、不可篡改
- **HIPAA**: PII 脱敏、访问审计、6 年留存
- **PCI-DSS**: 支付数据保护、访问控制

### 安全特性

- 事件链哈希（防篡改）
- 多租户隔离（数据安全）
- RBAC（最小权限）
- 脱敏（PII 保护）
- 访问审计（全程追溯）
- 离线验证（独立验证）

---

## 🎯 典型使用场景

### 场景 1: 金融支付审计

```bash
# 1. 查询所有支付 jobs
POST /api/forensics/query
{"tool_filter": ["stripe*"], "event_filter": ["payment_executed"]}

# 2. 批量导出证据包
POST /api/forensics/batch-export
{"job_ids": ["job_1", "job_2", "..."]}

# 3. 离线验证
aetheris verify batch-export.zip

# 4. 提交给合规团队
```

### 场景 2: 异常行为调查

```bash
# 1. 发现异常（监控告警）
# 2. 查看 Evidence Graph
GET /api/jobs/<job_id>/evidence-graph

# 3. 追溯决策链
# 4. 导出证据包
POST /api/jobs/<job_id>/export

# 5. 查看访问记录
GET /api/jobs/<job_id>/audit-log
```

### 场景 3: 定期合规审计

```bash
# 1. 查询时间范围内的所有 jobs
POST /api/forensics/query
{"time_range": {"start":"2026-02-01","end":"2026-02-28"}}

# 2. 批量导出
POST /api/forensics/batch-export

# 3. 检查一致性
GET /api/forensics/consistency/<job_id>

# 4. 生成审计报告
```

---

## 📈 性能

### 写入性能

- Hash 计算开销: +5-10%
- 审计日志异步: 不阻塞请求
- 总体影响: < 10%

### 查询性能

- Evidence Graph: < 100ms（小型 jobs）
- Forensics Query: < 500ms（1000 jobs）
- Batch Export: 异步，不阻塞

### 存储开销

- Hash 字段: +10%
- Audit Log: +3%
- Tombstone: +2%
- 总体: +15%

---

## 🛠️ 升级指南

### 前置条件

- Go 1.21+
- PostgreSQL 15+
- 停机时间: < 5 分钟（或零停机滚动升级）

### 升级步骤

```bash
# 1. 备份数据库
pg_dump aetheris > backup-before-2.0.sql

# 2. 运行 migration
psql aetheris < internal/runtime/jobstore/schema.sql

# 3. 更新代码
git pull origin main
go build ./...

# 4. 重启服务
systemctl restart aetheris-api
systemctl restart aetheris-worker

# 5. 验证
aetheris version
# 输出: aetheris 2.0.0
```

详见 `docs/migration-to-m1.md` 和后续迁移文档。

---

## 🐛 已知限制

1. **历史数据**: M1 之前的事件缺少 hash（可运行 backfill 工具）
2. **大型 jobs**: 事件数 > 10000 的 jobs 导出可能需要数分钟
3. **UI 性能**: Evidence Graph 超过 1000 节点时可能卡顿（建议过滤）
4. **签名**: M2 预留了签名字段，实际签名机制在 3.0

---

## 📚 文档

### 快速开始

- `README.md` - 项目介绍
- `docs/aetheris-2.0-complete.md` - 2.0 完整指南

### 里程碑文档

- `docs/m1-implementation-summary.md` - M1 详情
- `docs/m2-implementation-summary.md` - M2 详情
- `docs/m3-implementation-summary.md` - M3 详情

### 使用指南

- `docs/evidence-package.md` - 证据包使用
- `docs/m2-rbac-guide.md` - RBAC 配置
- `docs/m2-redaction-guide.md` - 脱敏策略
- `docs/m2-retention-guide.md` - 留存管理
- `docs/m3-evidence-graph-guide.md` - Evidence Graph
- `docs/m3-forensics-api-guide.md` - Forensics API
- `docs/m3-ui-guide.md` - UI 操作

---

## 🙏 贡献

感谢所有贡献者！Aetheris 2.0 由社区驱动，欢迎：
- 提交 Issue（bug 报告、功能建议）
- 提交 PR（代码贡献）
- 完善文档
- 分享使用经验

---

## 支持

- GitHub Issues: 请在当前仓库的 Issues 页面提交问题
- 文档: `docs/` 目录
- 社区: 当前以 GitHub Issues/PR 作为主要协作渠道

---

**Release Date**: 2026-02-12  
**Version**: 2.0.0  
**Status**: Open Source Release Candidate  

---

**下一个里程碑**: 3.0（签名机制 + 分布式 Ledger + AI 辅助取证）
