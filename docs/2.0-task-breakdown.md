# Aetheris 2.0 — Task Breakdown and Progress

This document is the **detailed task breakdown and progress tracker** for the 2.0 roadmap. Each roadmap task from [2.0-roadmap-detailed.md](2.0-roadmap-detailed.md) is split into concrete, assignable sub-tasks with a **phase** (1–5) and **status** (checkbox). Use it for sprint planning, assignment, and progress updates without duplicating the high-level roadmap table.

---

## Phase overview

| Phase | Name | Roadmap tasks in this phase |
|-------|------|-----------------------------|
| **1** | Core engine + Step Contract 2.0 | Eino kernel optimization; Step Contract 2.0 |
| **2** | Tool/Workflow + Runtime guarantees | At-most-once tool extension; Workflow nodes modularization; Signal loss and worker crash scenarios; Step timeout and failure policy; Distributed run consistency tests |
| **3** | Adapters + Trace & Audit | LangGraph Adapter; Custom Agent Adapter enhancement; Trace UI 2.0; Execution Forensics & Proof Chain |
| **4** | CLI/DevOps | CLI migrate, monitor, replay; CI/CD pipeline 2.0; Makefile/scripts for 2.0 services |
| **5** | Docs & tutorials | Getting Started 2.0; Adapter migration guide; Step Contract & best practices |

---

## Task breakdown by area

### 1. Core engine

**Task: Eino kernel optimization (complex DAG, step parallelism, lease/fencing)** — Phase 1

- [x] Write design doc for complex DAG execution and step parallelism (internal/agent/runtime/executor, design/).
- [x] Implement parallel step execution in Runner/DAG executor where DAG allows.
- [x] Strengthen lease and fencing in Scheduler/JobStore for multi-worker runs (design/scheduler-correctness.md).
- [x] Add integration tests for high-availability scenario (multiple workers, failover).
- [x] Document new behavior and limits in runtime-guarantees.md or design docs.

**Task: Step Contract 2.0 (side-effect control, async events, pluggable StepValidator)** — Phase 1

- [x] Define StepValidator interface and document in design/step-contract.md.
- [x] Add StepValidator registry and invocation point in executor (internal/agent/runtime/executor/).
- [x] Implement default validator that checks for time.Now, rand.*, and direct net/http usage in step code (or test harness).
- [x] Add async event handling contract and helpers (context, docs).
- [x] Add tests that run steps through the validator and assert contract compliance.

---

### 2. Tool/Workflow

**Task: At-most-once tool extension (Ledger for async/external APIs, retry/timeout policy)** — Phase 2

- [ ] Design Ledger extension for async and external API calls (design/effect-system.md or new doc).
- [ ] Implement retry policy and timeout in tool execution path (executor, node adapter).
- [ ] Document and test at-most-once semantics for async tools (ledger + effect store).
- [ ] Add optional idempotency key propagation to external clients (docs/examples).

**Task: Workflow nodes modularization (built-in wait/approval/condition, custom node registry)** — Phase 2

- [ ] Define built-in node types: wait, approval, condition (design or planner types).
- [ ] Implement custom node registry and discovery (internal/agent/planner or runtime/eino).
- [ ] Add at least one built-in wait/approval node implementation and wire to Signal.
- [ ] Document how to register custom nodes and use built-ins in getting-started or adapter docs.

---

### 3. Adapters

**Task: LangGraph Adapter (latest API, error handling and recovery)** — Phase 3

- [ ] Align adapter with latest LangGraph API (invoke, stream, state).
- [ ] Wrap LangGraph run as Aetheris step(s) with checkpoint and replay in mind.
- [ ] Add error handling and recovery (map LangGraph errors to StepResultType, retry/signal).
- [ ] Update docs/adapters/langgraph.md with migration steps and a minimal runnable example.
- [ ] Add integration test: run a small LangGraph graph via Aetheris and assert replay/signal behavior.

**Task: Custom Agent Adapter enhancement (Imperative → TaskGraph, CLI/SDK)** — Phase 3

- [ ] Extend task compatibility: support more imperative patterns in conversion (docs/adapters/custom-agent.md).
- [ ] Add or document CLI helpers for generating TaskGraph from existing code (e.g. scaffold).
- [ ] Provide SDK helpers or examples for Imperative → TaskGraph conversion (pkg/ or examples/).
- [ ] Add one end-to-end example (e.g. refund or approval) using the enhanced adapter.

---

### 4. Trace & Audit

**Task: Trace UI 2.0 (multi-job/agent view, step replay/diff)** — Phase 3

- [ ] Add multi-job or multi-agent aggregation view (API + UI: list jobs/agents, filter).
- [ ] Implement step-level replay control in Trace UI (replay to step N, show state at step).
- [ ] Add diff view for state before/after a step or between two steps (extend existing state-diff).
- [ ] Document Trace UI 2.0 in docs/tracing.md or observability.md.

**Task: Execution Forensics & Proof Chain (cross-worker/DAG audit, RAG/Tool provenance UI)** — Phase 3

- [ ] Design cross-worker and cross-DAG audit data model (design/execution-forensics.md).
- [ ] Expose RAG doc IDs and Tool provenance in trace/events and API.
- [ ] Add Forensics UI section: proof chain, provenance graph, or evidence list (Trace page or new page).
- [ ] Add tests or scripts that assert proof chain consistency for a sample job.

---

### 5. Runtime guarantees

**Task: Signal loss and worker crash scenarios (tests and docs)** — Phase 2

- [ ] Add tests for signal delivery (at-least-once, idempotent unblock) and document in runtime-contract.
- [ ] Add or extend tests for worker crash before/after tool commit and reclaim (beyond four fatal tests).
- [ ] Document signal loss and crash scenarios in docs/runtime-guarantees.md.
- [ ] Optional: add chaos or fault-injection test for signal and crash.

**Task: Step timeout and failure policy** — Phase 2

- [ ] Document current step_timeout behavior and failure policy (design or runtime-guarantees).
- [ ] Implement or clarify retry vs permanent-failure policy after timeout (Runner/ClassifyError).
- [ ] Add tests for step timeout and for retry/backoff behavior.
- [ ] Expose timeout and retry config in config files and document.

**Task: Distributed run consistency tests** — Phase 2

- [ ] Add tests that run multiple workers against the same job store and assert single execution per step.
- [ ] Add tests for reclaim and resume after worker crash (Postgres or in-memory with simulated crash).
- [ ] Add load or stress test: many jobs, multiple workers, assert no duplicate tool commits and consistent events.
- [ ] Document how to run distributed tests and expected guarantees.

---

### 6. CLI/DevOps

**Task: CLI — aetheris migrate, monitor, replay (and/or extend existing replay)** — Phase 4

- [x] Add `aetheris migrate` subcommand (e.g. schema or config migration) and document in docs/cli.md.
- [x] Add `aetheris monitor` (e.g. job/worker status, queue depth) and document.
- [x] Extend or document `aetheris replay` for 2.0 (replay options, output format).
- [x] Update README and docs with new CLI commands.

**Task: CI/CD pipeline 2.0 (multi-env deployment)** — Phase 4

- [ ] Add or update CI workflow for 2.0 (e.g. .github/workflows): build, test, optional integration tests.
- [ ] Document multi-environment deployment (staging, prod) in docs/deployment.md or devops.md.
- [ ] Add optional Docker or K8s targets for 2.0 services (API, Worker) if not already present.
- [ ] Add release checklist or script for 2.0 tag.

**Task: Makefile/scripts for 2.0 services** — Phase 4

- [x] Update Makefile with 2.0 targets (e.g. run-api, run-worker, run-all, test-integration).
- [x] Add or update scripts for local 2.0 stack (e.g. Postgres + API + Worker).
- [x] Document one-command run and required env in README or get-started.md.

---

### 7. Docs

**Task: Getting Started 2.0 (human-in-loop, API orchestration, auditable agent cases)** — Phase 5

- [ ] Consolidate or add human-in-the-loop example (refund approval) in getting-started-agents.md.
- [ ] Add API orchestration scenario (multi-API, long-running) with tools and timeout.
- [ ] Add auditable agent scenario (evidence chain, RAG provenance) with trace/replay steps.
- [ ] Link all three from README “When to Use Aetheris” and from 2.0-roadmap-detailed.

**Task: Adapter migration guide** — Phase 5

- [ ] Update docs/adapters/custom-agent.md with “Before / After” and link to E2E scenario.
- [ ] Complete docs/adapters/langgraph.md with concrete migration steps and code pointers.
- [ ] Add short “Adapter comparison” or index (Custom vs LangGraph vs future) in docs/adapters/ or README.

**Task: Step Contract & best practices** — Phase 5

- [ ] Add “Best practices” section to design/step-contract.md (or new doc): do’s and don’ts, examples.
- [ ] Document use of runtime.Clock(ctx) and runtime.RandIntn(ctx, n) and StepValidator in step-contract.
- [ ] Add troubleshooting: “Replay non-deterministic” and “Duplicate side effect” with common causes and fixes.

---

## Progress table

Update the Status column as work proceeds (Todo → In progress → Done).

| Phase | Roadmap task | Sub-task | Status |
|-------|--------------|----------|--------|
| 1 | Eino kernel optimization | Design doc for complex DAG and parallelism | Done |
| 1 | Eino kernel optimization | Implement parallel step execution | Done |
| 1 | Eino kernel optimization | Strengthen lease and fencing | Done |
| 1 | Eino kernel optimization | Integration tests for HA scenario | Done |
| 1 | Eino kernel optimization | Document new behavior | Done |
| 1 | Step Contract 2.0 | Define StepValidator interface and document | Done |
| 1 | Step Contract 2.0 | Add validator registry and invocation | Done |
| 1 | Step Contract 2.0 | Implement default validator (time/rand/http check) | Done |
| 1 | Step Contract 2.0 | Async event handling contract and helpers | Done |
| 1 | Step Contract 2.0 | Tests for validator and contract compliance | Done |
| 2 | At-most-once tool extension | Design Ledger extension for async/external APIs | Todo |
| 2 | At-most-once tool extension | Retry policy and timeout in tool path | Todo |
| 2 | At-most-once tool extension | Document and test at-most-once for async tools | Todo |
| 2 | At-most-once tool extension | Idempotency key propagation docs/examples | Todo |
| 2 | Workflow nodes modularization | Define built-in node types (wait, approval, condition) | Todo |
| 2 | Workflow nodes modularization | Custom node registry and discovery | Todo |
| 2 | Workflow nodes modularization | Implement built-in wait/approval node(s) | Todo |
| 2 | Workflow nodes modularization | Document custom node registration | Todo |
| 2 | Signal loss and worker crash scenarios | Tests for signal delivery and idempotent unblock | Todo |
| 2 | Signal loss and worker crash scenarios | Tests for worker crash and reclaim | Todo |
| 2 | Signal loss and worker crash scenarios | Document in runtime-guarantees.md | Todo |
| 2 | Signal loss and worker crash scenarios | Optional chaos/fault-injection test | Todo |
| 2 | Step timeout and failure policy | Document step_timeout and failure policy | Todo |
| 2 | Step timeout and failure policy | Retry vs permanent-failure after timeout | Todo |
| 2 | Step timeout and failure policy | Tests for timeout and retry | Todo |
| 2 | Step timeout and failure policy | Config and docs for timeout/retry | Todo |
| 2 | Distributed run consistency tests | Multi-worker same-job tests | Todo |
| 2 | Distributed run consistency tests | Reclaim and resume after crash tests | Todo |
| 2 | Distributed run consistency tests | Load/stress test (no duplicate commits) | Todo |
| 2 | Distributed run consistency tests | Document distributed test run and guarantees | Todo |
| 3 | LangGraph Adapter | Align with latest LangGraph API | Todo |
| 3 | LangGraph Adapter | Wrap run as Aetheris step(s) with checkpoint/replay | Todo |
| 3 | LangGraph Adapter | Error handling and recovery | Todo |
| 3 | LangGraph Adapter | Update langgraph.md and minimal example | Todo |
| 3 | LangGraph Adapter | Integration test for replay/signal | Todo |
| 3 | Custom Agent Adapter enhancement | Extend Imperative → TaskGraph compatibility | Todo |
| 3 | Custom Agent Adapter enhancement | CLI helpers for TaskGraph generation | Todo |
| 3 | Custom Agent Adapter enhancement | SDK helpers or examples | Todo |
| 3 | Custom Agent Adapter enhancement | End-to-end example | Todo |
| 3 | Trace UI 2.0 | Multi-job/agent aggregation view | Todo |
| 3 | Trace UI 2.0 | Step-level replay control in UI | Todo |
| 3 | Trace UI 2.0 | Diff view for state before/after step | Todo |
| 3 | Trace UI 2.0 | Document Trace UI 2.0 | Todo |
| 3 | Execution Forensics & Proof Chain | Design cross-worker/DAG audit model | Todo |
| 3 | Execution Forensics & Proof Chain | Expose RAG/Tool provenance in API and trace | Todo |
| 3 | Execution Forensics & Proof Chain | Forensics UI (proof chain, provenance) | Todo |
| 3 | Execution Forensics & Proof Chain | Tests for proof chain consistency | Todo |
| 4 | CLI migrate, monitor, replay | Add aetheris migrate and document | Done |
| 4 | CLI migrate, monitor, replay | Add aetheris monitor and document | Done |
| 4 | CLI migrate, monitor, replay | Extend/document aetheris replay for 2.0 | Done |
| 4 | CLI migrate, monitor, replay | Update README and docs | Done |
| 4 | CI/CD pipeline 2.0 | Add or update CI workflow for 2.0 | Todo |
| 4 | CI/CD pipeline 2.0 | Document multi-env deployment | Todo |
| 4 | CI/CD pipeline 2.0 | Docker/K8s targets for 2.0 services | Todo |
| 4 | CI/CD pipeline 2.0 | Release checklist or script for 2.0 | Todo |
| 4 | Makefile/scripts for 2.0 services | Update Makefile with 2.0 targets | Done |
| 4 | Makefile/scripts for 2.0 services | Scripts for local 2.0 stack | Done |
| 4 | Makefile/scripts for 2.0 services | Document one-command run | Done |
| 5 | Getting Started 2.0 | Human-in-the-loop example | Todo |
| 5 | Getting Started 2.0 | API orchestration scenario | Todo |
| 5 | Getting Started 2.0 | Auditable agent scenario | Todo |
| 5 | Getting Started 2.0 | Link from README and roadmap | Todo |
| 5 | Adapter migration guide | Update custom-agent.md and E2E link | Todo |
| 5 | Adapter migration guide | Complete langgraph.md migration steps | Todo |
| 5 | Adapter migration guide | Adapter comparison or index | Todo |
| 5 | Step Contract & best practices | Best practices section in step-contract.md | Todo |
| 5 | Step Contract & best practices | Document Clock/RandIntn and StepValidator | Todo |
| 5 | Step Contract & best practices | Troubleshooting (replay, duplicate side effect) | Todo |

---

## References

- **High-level roadmap table**: [docs/2.0-roadmap-detailed.md](2.0-roadmap-detailed.md)
- **Phase timeline and Gantt**: [docs/2.0-roadmap-timeline.md](2.0-roadmap-timeline.md)
- **2.0 modules and phases**: [design/aetheris-2.0-overview.md](../design/aetheris-2.0-overview.md)
