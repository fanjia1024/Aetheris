{
  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus",
      "description": "",
      "type": "datasource",
      "pluginId": "prometheus",
      "pluginName": "Prometheus"
    }
  ],
  "__requires": [
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "9.0.0"
    },
    {
      "type": "datasource",
      "id": "prometheus",
      "name": "Prometheus",
      "version": "1.0.0"
    },
    {
      "type": "panel",
      "id": "timeseries",
      "name": "Time series",
      "version": ""
    },
    {
      "type": "panel",
      "id": "stat",
      "name": "Stat",
      "version": ""
    },
    {
      "type": "panel",
      "id": "gauge",
      "name": "Gauge",
      "version": ""
    }
  ],
  "annotations": {
    "list": []
  },
  "description": "Aetheris Agent Runtime — 核心可观测性面板（Job 吞吐、LLM Token、限流、Worker 负载）",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 0},
      "id": 100,
      "title": "Job 吞吐 & 状态",
      "type": "row"
    },
    {
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {"lineWidth": 2},
          "unit": "ops"
        },
        "overrides": []
      },
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 1},
      "id": 1,
      "options": {
        "legend": {"calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom"},
        "tooltip": {"mode": "multi"}
      },
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
          "expr": "rate(aetheris_jobs_total[5m])",
          "legendFormat": "Jobs Created / sec",
          "refId": "A"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
          "expr": "rate(aetheris_jobs_completed_total[5m])",
          "legendFormat": "Jobs Completed / sec",
          "refId": "B"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
          "expr": "rate(aetheris_jobs_failed_total[5m])",
          "legendFormat": "Jobs Failed / sec",
          "refId": "C"
        }
      ],
      "title": "Job 创建 / 完成 / 失败速率",
      "type": "timeseries"
    },
    {
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 50},
              {"color": "red", "value": 100}
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {"h": 8, "w": 6, "x": 12, "y": 1},
      "id": 2,
      "options": {"colorMode": "background", "graphMode": "area", "justifyMode": "auto", "orientation": "auto"},
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
          "expr": "aetheris_jobs_running",
          "legendFormat": "In-Flight Jobs",
          "refId": "A"
        }
      ],
      "title": "当前执行中 Jobs",
      "type": "stat"
    },
    {
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 10},
              {"color": "red", "value": 30}
            ]
          },
          "unit": "s"
        },
        "overrides": []
      },
      "gridPos": {"h": 8, "w": 6, "x": 18, "y": 1},
      "id": 3,
      "options": {"colorMode": "background", "graphMode": "area", "justifyMode": "auto", "orientation": "auto"},
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
          "expr": "histogram_quantile(0.95, rate(aetheris_job_duration_seconds_bucket[5m]))",
          "legendFormat": "P95 Job Duration",
          "refId": "A"
        }
      ],
      "title": "Job P95 执行时长",
      "type": "stat"
    },
    {
      "collapsed": false,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 9},
      "id": 101,
      "title": "Rate Limit 等待",
      "type": "row"
    },
    {
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {"lineWidth": 2},
          "unit": "s"
        },
        "overrides": []
      },
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 10},
      "id": 4,
      "options": {
        "legend": {"calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom"},
        "tooltip": {"mode": "multi"}
      },
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
          "expr": "histogram_quantile(0.99, rate(aetheris_rate_limit_wait_seconds_bucket{type=\"llm\"}[5m]))",
          "legendFormat": "LLM P99 Wait ({{provider}})",
          "refId": "A"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
          "expr": "histogram_quantile(0.99, rate(aetheris_rate_limit_wait_seconds_bucket{type=\"tool\"}[5m]))",
          "legendFormat": "Tool P99 Wait ({{tool_name}})",
          "refId": "B"
        }
      ],
      "title": "Rate Limit 等待时间 P99（LLM & Tool）",
      "type": "timeseries"
    },
    {
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {"lineWidth": 2},
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 10},
      "id": 5,
      "options": {
        "legend": {"calcs": ["sum"], "displayMode": "table", "placement": "bottom"},
        "tooltip": {"mode": "multi"}
      },
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
          "expr": "rate(aetheris_rate_limit_rejections_total[5m])",
          "legendFormat": "Rate Limit Rejections / sec ({{type}} {{tool_name}})",
          "refId": "A"
        }
      ],
      "title": "Rate Limit 拒绝速率",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 18},
      "id": 102,
      "title": "Worker 负载",
      "type": "row"
    },
    {
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {"lineWidth": 2},
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 19},
      "id": 6,
      "options": {
        "legend": {"calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom"},
        "tooltip": {"mode": "multi"}
      },
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
          "expr": "aetheris_worker_active_jobs",
          "legendFormat": "Active Jobs ({{worker_id}})",
          "refId": "A"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
          "expr": "aetheris_worker_max_concurrency",
          "legendFormat": "Max Concurrency ({{worker_id}})",
          "refId": "B"
        }
      ],
      "title": "Worker 并发占用",
      "type": "timeseries"
    },
    {
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {"lineWidth": 2},
          "unit": "s"
        },
        "overrides": []
      },
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 19},
      "id": 7,
      "options": {
        "legend": {"calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom"},
        "tooltip": {"mode": "multi"}
      },
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
          "expr": "histogram_quantile(0.95, rate(aetheris_tool_execution_duration_seconds_bucket[5m]))",
          "legendFormat": "Tool P95 Duration ({{tool_name}})",
          "refId": "A"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
          "expr": "histogram_quantile(0.95, rate(aetheris_llm_request_duration_seconds_bucket[5m]))",
          "legendFormat": "LLM P95 Duration ({{provider}})",
          "refId": "B"
        }
      ],
      "title": "Tool & LLM P95 执行时长",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 27},
      "id": 103,
      "title": "LLM Token 使用",
      "type": "row"
    },
    {
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"},
          "custom": {"lineWidth": 2},
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 28},
      "id": 8,
      "options": {
        "legend": {"calcs": ["sum"], "displayMode": "table", "placement": "bottom"},
        "tooltip": {"mode": "multi"}
      },
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
          "expr": "rate(aetheris_llm_tokens_total{type=\"prompt\"}[5m])",
          "legendFormat": "Prompt Tokens / sec ({{provider}})",
          "refId": "A"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
          "expr": "rate(aetheris_llm_tokens_total{type=\"completion\"}[5m])",
          "legendFormat": "Completion Tokens / sec ({{provider}})",
          "refId": "B"
        }
      ],
      "title": "LLM Token 消耗速率",
      "type": "timeseries"
    },
    {
      "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 50000},
              {"color": "red", "value": 80000}
            ]
          },
          "unit": "short",
          "max": 90000
        },
        "overrides": []
      },
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 28},
      "id": 9,
      "options": {"minVizHeight": 75, "minVizWidth": 75, "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}},
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_PROMETHEUS}"},
          "expr": "aetheris_llm_tokens_used_minute",
          "legendFormat": "Tokens Used This Minute ({{provider}})",
          "refId": "A"
        }
      ],
      "title": "LLM Token 分钟用量（vs 配额 90K）",
      "type": "gauge"
    }
  ],
  "refresh": "30s",
  "schemaVersion": 36,
  "style": "dark",
  "tags": ["aetheris", "agent", "llm"],
  "templating": {
    "list": []
  },
  "time": {"from": "now-1h", "to": "now"},
  "timepicker": {},
  "timezone": "browser",
  "title": "Aetheris Agent Runtime",
  "uid": "aetheris-runtime-v2",
  "version": 1
}
