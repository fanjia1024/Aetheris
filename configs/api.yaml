# API 服务配置
api:
  port: 8080
  host: "0.0.0.0"
  timeout: 30s
  cors:
    enable: true
    allow_origins: ["*"]
  middleware:
    auth: false
    rate_limit: true
    rate_limit_rps: 100
    # JWT（auth 为 true 时生效）；jwt_key 建议用环境变量 "${JWT_SECRET}"
    jwt_key: ""
    jwt_timeout: "1h"
    jwt_max_refresh: "1h"
  grpc:
    enable: false
    port: 9090

# 任务事件存储（事件流 + 租约）；未配置或 type 非 postgres 时使用内存后端
# 当 type=postgres 时，仅由 Worker 进程通过事件 Claim 执行，API 不启动进程内 Scheduler（单一执行权）
jobstore:
  type: "memory"           # memory | postgres
  dsn: ""                  # type=postgres 时必填，如 "postgres://user:pass@localhost:5432/db?sslmode=disable"
  lease_duration: "30s"     # 租约时长；Heartbeat 间隔建议 < lease_duration/2

# v1 Agent 与 Job 调度（仅 jobstore.type=memory 时生效；postgres 时 API 不拉取，由 Worker 唯一执行）
agent:
  job_scheduler:
    enabled: true        # 仅内存模式有效；postgres 时强制不启 API Scheduler
    max_concurrency: 2   # 最大并发执行 Job 数
    retry_max: 2       # 失败后最大重试次数（不含首次）
    backoff: "1s"      # 重试前等待时间

# 服务发现
service:
  agent_service:
    addr: "localhost:9090"
    timeout: 10s
  index_service:
    addr: "localhost:9091"
    timeout: 30s

# 日志配置
log:
  level: "info"
  format: "json"
  file: ""

# 监控配置
monitoring:
  prometheus:
    enable: true
    port: 9092
  # 链路追踪（OpenTelemetry），未配置 endpoint 时可使用环境变量 OTEL_EXPORTER_OTLP_ENDPOINT
  tracing:
    enable: false
    service_name: "rag-api"
    export_endpoint: ""   # 如 "localhost:4317"
    insecure: true